{% extends 'base.html' %}
{% block title %}{{ recipe.name }}{% endblock %}

{% block content %}
<article class="recipe-detail">
  <div class="recipe-container">
    <div class="recipe-layout">
      
      <!-- LEWA KOLUMNA -->
      <aside class="recipe-info">
        <img src="{{ url_for('static', filename='images/' + recipe.image) }}" alt="{{ recipe.name }}" class="recipe-image">

        <h3>Informacje</h3>
        <ul class="recipe-meta">
          <li><i class="fa fa-fire"></i> TrudnoÅ›Ä‡: <strong>{{ recipe.difficulty }}</strong></li>
          <li><i class="fa fa-clock-o"></i> Czas przygotowania: <strong>{{ recipe.time }}</strong></li>
          <li><i class="fa fa-cutlery"></i> Porcje: <strong>{{ recipe.portions }}</strong></li>
        </ul>

        <h3>SkÅ‚adniki</h3>
        <ul class="ingredients">
          {% for item in recipe.ingredients %}
          <li>{{ item.text }}</li>
          {% endfor %}
        </ul>
      </aside>

      <!-- PRAWA KOLUMNA -->
      <section class="recipe-steps">
        <h2 class="recipe-title">{{ recipe.name }}</h2>

        <h3>Przygotowanie</h3>
        <ol class="steps">
          {% for step in recipe.steps|sort(attribute='order') %}
          <li><strong>KROK {{ loop.index }}:</strong> {{ step.text }}</li>
          {% endfor %}
        </ol>
      </section>
    </div> <!-- ðŸ”¹ koniec recipe-layout -->

    <!-- ðŸ”¹ BLOK DODAWANIA KOMENTARZA -->
    <!-- ðŸ”¹ KOMENTARZE (opakowane razem, by zachowaÄ‡ szerokoÅ›Ä‡) -->
<div class="comments-wrapper">

  {% if session.username %}
    <section>
      {% if user_comment %}
        <h3>TwÃ³j komentarz</h3>
        <div>
          <strong>{{ user_comment.user.username }}</strong> 
          ({{ user_comment.created_at.strftime('%Y-%m-%d') }}) - Ocena:
          {% for i in range(1,6) %}
            <span class="fa fa-star {% if i <= user_comment.rating %}star-checked{% endif %}"></span>
          {% endfor %}
          <p>{{ user_comment.text }}</p>

          <form action="{{ url_for('delete_comment', recipe_id=recipe.id, comment_id=user_comment.id) }}" method="POST">
            <button type="submit" class="delete-btn">UsuÅ„ komentarz</button>
          </form>
        </div>
      {% else %}
        <h3>Dodaj komentarz</h3>
        <form action="{{ url_for('add_comment', recipe_id=recipe.id) }}" method="POST" class="comment-form">
          <label>Ocena:</label>
          <div class="star-rating">
            {% for i in range(1,6) %}
              <span class="fa fa-star" data-value="{{ i }}" style="cursor:pointer; font-size:1.5em;"></span>
            {% endfor %}
            <input type="hidden" name="rating" id="rating" required>
          </div>

          <textarea name="text" rows="3" placeholder="Napisz komentarz..." required></textarea>
          <button type="submit" class="add-btn">Dodaj komentarz</button>
        </form>
      {% endif %}
    </section>
  {% else %}
    <section>
      <p><a href="#" onclick="openModal('loginModal')">Zaloguj siÄ™</a>, aby dodaÄ‡ komentarz.</p>
    </section>
  {% endif %}

  <section>
    <h3>Komentarze</h3>
    {% if recipe.comments %}
      <ul>
        {% for comment in recipe.comments %}
          <li>
            <strong>{{ comment.user.username }}</strong> 
            ({{ comment.created_at.strftime('%Y-%m-%d') }}) - Ocena:
            {% for i in range(1,6) %}
              <span class="fa fa-star {% if i <= comment.rating %}star-checked{% endif %}"></span>
            {% endfor %}
            <p>{{ comment.text }}</p>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>Brak komentarzy. BÄ…dÅº pierwszy!</p>
    {% endif %}
  </section>

</div> <!-- ðŸ”¹ koniec comments-wrapper -->


  </div> <!-- ðŸ”¹ koniec recipe-container -->
</article>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    initStarRating('.star-rating', '#rating');
  });
</script>
{% endblock %}
