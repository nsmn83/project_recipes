{% extends 'base.html' %}
{% block title %}Panel Admina{% endblock %}

{% block content %}
<div class="admin-container">
  <h1>Panel Administratora</h1>
  
  <section class="admin-section">
    <div class="section-header">
      <h2>Przepisy ({{ recipes|length }})</h2>
      <a href="{{ url_for('add_recipe') }}" class="btn btn-success">
        <i class="fa fa-plus"></i> Dodaj przepis
      </a>
    </div>
    
    <div class="admin-table-wrapper">
      <table class="admin-table">
        <thead>
          <tr>
            <th style="width: 5%;">ID</th>
            <th style="width: 30%;">Nazwa</th>
            <th style="width: 15%;">Kategoria</th>
            <th style="width: 10%;">Czas</th>
            <th style="width: 10%;">Trudność</th>
            <th style="width: 10%;">Ocena</th>
            <th style="width: 20%; text-align: center;">Akcje</th>
          </tr>
        </thead>
        <tbody>
          {% for recipe in recipes %}
          <tr>
            <td>{{ recipe.id }}</td>
            <td><strong>{{ recipe.name }}</strong></td>
            <td>{{ recipe.category }}</td>
            <td>{{ recipe.time }}</td>
            <td>{{ recipe.difficulty }}</td>
            <td>{{ recipe.rating }}</td>
            <td class="action-buttons" style="text-align: center;">
              <a href="{{ url_for('recipe_detail', recipe_id=recipe.id) }}" class="btn btn-info" title="Podgląd">
                <i class="fa fa-eye"></i>
              </a>
              <form action="{{ url_for('admin_delete_recipe', recipe_id=recipe.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('Czy na pewno chcesz usunąć ten przepis?');">
                <button type="submit" class="btn btn-danger" title="Usuń">
                  <i class="fa fa-trash"></i>
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <section class="admin-section">
    <h2>Użytkownicy ({{ users|length }})</h2>
    <div class="admin-table-wrapper">
      <table class="admin-table">
        <thead>
          <tr>
            <th style="width: 5%;">ID</th>
            <th style="width: 40%;">Nazwa użytkownika</th>
            <th style="width: 15%;">Admin</th>
            <th style="width: 20%;">Komentarze</th>
            <th style="width: 20%; text-align: center;">Akcje</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
          <tr>
            <td>{{ user.id }}</td>
            <td>{{ user.username }}</td>
            <td>
              {% if user.is_admin %}
              <span class="badge-admin">Admin</span>
              {% else %}
              User
              {% endif %}
            </td>
            <td>{{ user.comments|length }}</td>
            <td class="action-buttons" style="text-align: center;">
              {% if user.id != session['user_id'] %}
              <form action="{{ url_for('admin_delete_user', user_id=user.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('Usunąć użytkownika?');">
                <button type="submit" class="btn btn-danger">
                  <i class="fa fa-trash"></i>
                </button>
              </form>
              {% else %}
              <span class="text-muted">(Ty)</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <section class="admin-section">
    <h2>Ostatnie komentarze ({{ comments|length }})</h2>
    <div class="admin-table-wrapper">
      <table class="admin-table">
        <thead>
          <tr>
            <th style="width: 5%;">ID</th>
            <th style="width: 15%;">Kto</th>
            <th style="width: 15%;">ID użytkownika</th>
            <th style="width: 15%;">Gdzie</th>
            <th style="width: 10%;">Ocena</th>
            <th style="width: 40%;">Treść</th>
            <th style="width: 15%; text-align: center;">Akcje</th>
          </tr>
        </thead>
        <tbody>
          {% for comment in comments|sort(attribute='created_at', reverse=True) %}
          <tr>
            <td>{{ comment.id }}</td>
            <td>{{ comment.user.username }}</td>
            <td>{{ comment.user_id}}</td>
            <td><a href="{{ url_for('recipe_detail', recipe_id=comment.recipe.id) }}">{{ comment.recipe.name|truncate(20) }}</a></td>
            <td>
              <span style="color: #f39c12;">★</span> {{ comment.rating }}
            </td>
            <td>
              <div class="comment-text" title="{{ comment.text }}">
                {{ comment.text }}
              </div>
            </td>
            <td class="action-buttons" style="text-align: center;">
              <form action="{{ url_for('admin_delete_comment', comment_id=comment.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('Usunąć komentarz?');">
                <button type="submit" class="btn btn-danger">
                  <i class="fa fa-trash"></i>
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
</div>

{% endblock %}